
# 使用说明文档

## 介绍
该程序用于处理课堂师生对话数据并调用指定模型进行文本分析。通过传递模型参数、数据处理参数以及待分析的数据，程序可以输出处理后的结果并保存为 Excel 文件以及 JSON 文件。

## 函数说明

### `main(model_parameters, data_processor, data, prompt, output_path)`

主函数，处理数据并进行分析。需要传入多个参数，包括模型参数、数据处理参数、输入数据、模型提示语和输出路径。

### 参数说明

| 参数名          | 类型   | 是否必需 | 描述                                                                                       |
|-----------------|--------|----------|--------------------------------------------------------------------------------------------|
| `model_parameters` | `dict` | 否       | 用于配置模型调用的相关参数。如果不传递此参数，脚本只进行数据处理部分，不会调用闭源模型。             |
| `data_processor`   | `dict` | 是       | 配置数据处理的相关参数，控制数据处理逻辑。                                                   |
| `data`             | `dict` | 是       | 待处理的数据，包含开始时间、结束时间、文本和标签等字段。                                     |
| `prompt`           | `str`  | 是       | 模型的基础提示语，用于指导模型如何分析输入文本。                                             |
| `output_path`      | `str`  | 是       | 输出文件的路径，结果将保存为 Excel 文件。                                                    |

### `model_parameters` 详细说明

| 参数名          | 类型   | 是否必需 | 描述                                                                                       |
|-----------------|--------|----------|--------------------------------------------------------------------------------------------|
| `model_family`  | `str`  | 是        | 模型类别，例如 `"glm-4"`。                                                                  |
| `api_key`       | `str`  | 是        | 用于访问模型的 API 密钥。                                                                   |
| `model_name`    | `str`  | 是        | 模型名称，例如 `"glm-4-flash"`。                                                            |
| `api_version`   | `str`  | 否        | API 版本号，例如 `"v1"`。                                                                   |
| `prompt`        | `str`  | 动态添加  | 模型分析时使用的提示语，在执行过程中由脚本动态添加。                                         |

### `data_processor` 详细说明

| 参数名          | 类型   | 是否必需 | 描述                                                                                       |
|-----------------|--------|----------|--------------------------------------------------------------------------------------------|
| `Task`          | `str`  | 是        | 数据处理任务名称，决定数据处理逻辑，例如 `"teacher_dialogue_classification"`。               |
| `T`             | `int`  | 是        | 时间差阈值，仅针对 `label` 为 0 的行，单位为毫秒，表示任务之间的最大时间差。                 |

### `data` 详细说明

| 参数名          | 类型   | 是否必需 | 描述                                                                                       |
|-----------------|--------|----------|--------------------------------------------------------------------------------------------|
| `start_time`    | `list` | 是        | 课堂对话的开始时间列表，单位为毫秒。                                                         |
| `end_time`      | `list` | 是        | 课堂对话的结束时间列表，单位为毫秒。                                                         |
| `text`          | `list` | 是        | 课堂师生对话的文本列表。                                                                     |
| `label`         | `list` | 是        | 对应文本的标签列表，通常用于标记文本的类型（例如老师话语或学生话语）。                        |

## 使用示例

```python
if __name__ == '__main__':
    model_parameters = {
        'model_family': 'gpt4o',
        'api_key': 'b2e709bdd54f4416a734b4a6f8f1c7a0',
        'model_name': 'soikit_test',
        'api_version': '2024-02-01',
        'prompt': ''
    }

    data_processor = {
        'Task': 'teacher_dialogue_classification',
        'T': 500
    }

    data = {
        'start_time': [27300, 35310, 40560, 45590, 47910, 50070, 52780, 53000],
        'end_time': [32940, 39510, 42710, 47190, 49590, 52760, 52790, 69880],
        'text': [
            '具你，为什么要我买？这是第一套。',
            '喂，你，吃你吃你狗，你，',
            '好，把语文书翻到第50页，',
            '然后铅笔收起来把，',
            '课堂练习放到左上角，',
            '先把语文书翻到翻到第50页，翻到这里，',
            '没有，50。我现在这个阳猫世，',
            '我看谁今天坐姿有问题啊啊，'
        ],
        'label': [0, 1, 0, 0, 1, 0, 1, 0]
    }

    prompt = "后面的“待分析文本”是一段发生在课堂上的师生对话..."
    output_path = "output.xlsx"

    main(model_parameters, data_processor, data, prompt, output_path)
```

## 输出结果
- 程序会生成一个 Excel 文件，文件包含经过处理和模型分析后的结果。
- 同时，程序还会生成一个 JSON 文件，保存任务相关的结果数据。

## 日志
运行过程中，程序会记录详细的日志信息，包含输入校验、数据处理、模型调用等多个步骤的信息。
日志将帮助你快速定位潜在的问题和错误。

