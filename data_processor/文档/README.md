
# DataProcessor: 专注于数据处理的灵活工具

## 概述

`DataProcessor` 是一个专注于数据处理的工具类，允许用户根据不同的任务需求对数据进行分割、合并和输出。该类提供了一种灵活的方式来处理对话或课堂活动数据，用户可以自定义时间差阈值 `T` 并为不同的任务指定不同的处理逻辑。

### 主要特点：
- **任务驱动**：支持不同的任务类型（如师生对话分类、课堂活动分类），通过 `task` 参数动态选择处理逻辑。
- **灵活的分割策略**：通过 `T` 参数自定义数据分割的时间差阈值，并且每种任务可以使用不同的分割逻辑。
- **结果输出**：处理后的数据可以通过 JSON 格式输出，方便后续的数据分析或存储。

## 参数说明

### 1. `dataset`
需要处理的输入数据，可以是 `pandas DataFrame` 或 JSON 字符串。

### 2. `task`
任务名称，用于选择不同的处理逻辑，例如：
- `"teacher_dialogue_classification"`：处理师生对话分类任务。
- `"teacher_activity_classification"`：处理课堂活动分类任务。

### 3. `T`
自定义时间差阈值（以毫秒为单位），用于决定如何分割对话或活动片段。

## 类中的主要方法

### 1. `split_data`
- **功能**：根据 `task` 和时间差 `T` 对数据进行分割。
- **返回**：分割后的子数据集列表（每个子集是一个 `DataFrame`）。

### 2. `merge_text_by_label`
- **功能**：根据 `task` 参数，按 `label` 合并连续的对话或活动片段。
- **返回**：合并后的 `DataFrame`，将连续相同 `label` 的文本合并为一个条目。

### 3. `process_and_save_sub_dfs`
- **功能**：将数据进行分割、合并，并将结果以 JSON 格式输出。
- **返回**：处理后的子数据集的 JSON 列表。

## 使用示例

```python
# 示例数据


data = {
    'start_time': [27300, 35310, 40560, 45590, 47910, 50070, 54340, 67170],
    'end_time': [32940, 39510, 42710, 47190, 49590, 52760, 64670, 69880],
    'text': [
        "具你，为什么要我买？这是第一套。",
        "喂，你，吃你吃你狗，你，",
        "好，把语文书翻到第50页，",
        "然后铅笔收起来把，",
        "课堂练习放到左上角，",
        "先把语文书翻到翻到第50页，翻到这里，",
        "没有，50。我现在这个阳猫世，",
        "我看谁今天的坐姿有问题啊啊，"
    ],
    'label': [1, 1, 0, 0, 0, 0, 1, 0]
}
df = pd.DataFrame(data)

# 初始化DataProcessor，任务为师生对话分类，时间差T由用户自定义
processor = DataProcessor(
    dataset=df,  # 传入数据集
    task="teacher_dialogue_classification",  # 任务名称
    T=3000  # 自定义时间差，3秒
)

# 处理数据
json_output = processor.process_and_save_sub_dfs()

# 输出结果
for json_data in json_output:
    print(json_data)
```

### 输出示例

处理后的数据将以 JSON 格式返回：

```json
[
    {
        "start_time": 27300,
        "end_time": 39510,
        "text": "具你，为什么要我买？这是第一套。喂，你，吃你吃你狗，你，",
        "label": 1
    },
    {
        "start_time": 40560,
        "end_time": 52760,
        "text": "好，把语文书翻到第50页，然后铅笔收起来把，课堂练习放到左上角，先把语文书翻到翻到第50页，翻到这里，",
        "label": 0
    },
    {
        "start_time": 54340,
        "end_time": 64670,
        "text": "没有，50。我现在这个阳猫世，",
        "label": 1
    },
    {
        "start_time": 67170,
        "end_time": 69880,
        "text": "我看谁今天的坐姿有问题啊啊，",
        "label": 0
    }
]
```

## 扩展性

`DataProcessor` 设计灵活，未来可以轻松扩展其他任务。用户只需：
1. 在 `__init__` 中添加新的 `task` 类型。
2. 在 `split_data` 和 `merge_text_by_label` 方法中根据新任务类型添加处理逻辑。

## 结论

`DataProcessor` 是一个灵活且可扩展的数据处理工具，支持基于任务的工作流，并能够处理各种形式的对话数据或课堂活动数据。通过合理设置 `T` 和 `task` 参数，用户可以轻松实现复杂的数据处理任务。
